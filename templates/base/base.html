{% load staticfiles %}
<!doctype html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />
    </head>
    <body>
        <header></header>
        <main>
            {% block main %}{% endblock %}
        </main>
        <footer></footer>
    </body>
    <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
    <script>
	var count = {{img_count}};
        var p = 0;

        function clear_form(){
            var f = document.getElementByID('sheet');
            f.reset();
        }
	function reset_images(){
		$('input:checkbox:checked').prop('checked', false).prop('disabled', false).val(0);
		p = 0;
	}	
	$(document).ready(function(){
		reset_images();

		$('input[type=checkbox]').change(function(){
			if(this.checked){
				p++;
				$(this).attr('value', p);
				$(this).prop('disabled', true);
			}
		});

		$('#reset').click(function(){reset_images()});

		$( "form" ).on( "submit", function( event ) {
			  event.preventDefault();
			  var profile = $('form').serializeArray(),
			      req = {},
			      imgs = {};
			  profile.forEach(function(item, i, profile){
				req[item.name] = item.value;
			  });
			  $( ':checkbox' ).each(function(){
			  	var n = $(this).attr('name'),
				    v = $(this).attr('value');
				    imgs[n] = v;
			  });
			  req["images"] = imgs;
			  req["stimul"] = {{ stimul.id }};
			  $.ajax({
				  url: "{% url 'submit' %}",
				data:req,
				method: "POST",
			   	dataType: "json",
                          }).done(function(result){
                            if(result === 0){
                                reset_images();
                                alert('Спасибо за участие в эксперименте! Ваши данные успешно обработаны!');
                                reset_images();
                            } else if(result === 1) {
                                reset_images();
                                alert('Вы уже учавствовали в этом эксперименте!');
                            } else {
                                alert('Всё поломалось!')
                            }
                          });
		});


	});
    </script> 
</html>    
