{% extends 'base/base.html' %}
{% block main %}
{% if user.is_authenticated %}
<h1>Welcome, {{ user.get_username }}! <a href="{% url 'logout' %}"><i class="fa fa-sign-out" aria-hidden="true"></i></a></h1>
{% else %}
   <h1>Welcome, new user. Please log in.</h1>
{% endif %}
<section class="card small profile">
    <h2>Профиль </h2>
    <form id="id_user" action="{% url 'change_user' %}">
        {% csrf_token %}
        {% for field in u_form %}
        <div>
            {{ field.errors }}
            <div>{{ field.label_tag }} {{ field }}</div>
            {% if field.help_text %}
                <p class="help">{{ field.help_text|safe }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </form>
    <form id="id_userinfo" action="{% url 'change_userinfo' %}">
        {% csrf_token %}
        {% for field in ui_form %}
        <div>
            {{ field.errors }}
            <div>{{ field.label_tag }} {{ field }}</div>
            {% if field.help_text %}
                <p class="help">{{ field.help_text|safe }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </form>
</section>
<section class="card small">
    <h2>Доступные стимулы</h2>
    <ul>
        {% for s in stimuli_n%}
	<li><a href="{% url 'stimulus' s.id %}">{{s.name}}</a></li>
        {% empty %}
	<li>Вы уже пощупали все стимулы!<br/>Спасибо вам огромное! :)</li>
        {% endfor %}
    </ul>
</section>
<section class="card small">
    <h2>Пройденные стимулы</h2>
    <ul>
        {% for s in stimuli_p%}
	<li>{{s.name}}</li>
        {% empty %}
        <li>Вы еще ничего не щупали :(</li>
        {% endfor %}
    </ul>
</section>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    function send_data($form){
            var profile = $(".profile");
            profile.addClass('edit');
            var data = $form.serialize();
            $.ajax($form.attr('action'), {data:data, type:'POST'}).done(function(){
                profile.removeClass("edit");
            }); 
    }
    
    $(document).ready(function(){
        $('#id_user, #id_userinfo').change(function(){
            send_data($(this));
        });

    });
</script>
{% endblock %}
